<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtlasIntern: AI Internship Recommender</title>
    
    <!-- Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts for a clean, readable UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons from Phosphor Icons for visual cues -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- PDF.js library for parsing resumes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <style>
        /* CSS Variables for theming */
        :root {
            --color-primary-from: #6d28d9;
            --color-primary-to: #4f46e5;
            --color-primary: #5b21b6;
            --color-primary-hover: #4c1d95;
            --color-accent: #c4b5fd;
            --color-check: #16a34a;
            --color-check-light: #bbf7d0;
            --shadow-primary: rgba(93, 33, 181, 0.4);
            --shadow-check: rgba(22, 163, 74, 0.2);
        }

        /* Custom styles to enhance the UI */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23eef2ff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            overflow-x: hidden;
        }
        
        /* Interactive Animations */
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
        
        /* Bouncy step transition */
        .wizard-step { display: none; }
        .wizard-step.active-forward {
            display: block;
            animation: bounceInFromRight 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .wizard-step.active-backward {
            display: block;
            animation: bounceInFromLeft 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes bounceInFromRight {
            0% { opacity: 0; transform: translateX(100%); }
            60% { opacity: 1; transform: translateX(-10%); }
            100% { transform: translateX(0); }
        }
        @keyframes bounceInFromLeft {
            0% { opacity: 0; transform: translateX(-100%); }
            60% { opacity: 1; transform: translateX(10%); }
            100% { transform: translateX(0); }
        }

        .internship-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
            animation: fadeIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
            border: 1px solid #e2e8f0;
        }

        .internship-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        /* Bouncy button and card styles */
        .interactive-btn {
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, background-color 0.2s ease;
        }
        .interactive-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 20px 0 var(--shadow-primary);
        }
        .interactive-btn:active {
            transform: scale(0.97);
        }
        
        /* Sort button styles */
        .sort-btn {
            transition: all 0.2s ease;
        }
        .sort-btn:not(.active):hover {
            transform: translateY(-2px);
            background-color: var(--color-accent);
            color: var(--color-primary);
        }
        .sort-btn.active {
            background-color: var(--color-primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 2px 10px var(--shadow-primary);
        }

        /* Generic selection interaction */
        .selectable-card {
            position: relative;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, border-color 0.2s ease;
        }
        
        .peer:not(:checked) + .selectable-card:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: var(--color-accent);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }

        .peer:checked + .selectable-card, .peer[type=radio]:checked + .selectable-card {
            transform: scale(1.08);
            border-color: var(--color-check);
            box-shadow: 0 0 0 2px var(--color-check-light), 0 4px 12px var(--shadow-check);
        }

        /* Checkmark for selected cards */
        .checkmark {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background-color: var(--color-check);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .peer:checked + .selectable-card .checkmark {
            opacity: 1;
            transform: scale(1);
        }

        /* Skill tags */
        .skill-tag {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
        }
        .skill-card-name {
             margin-bottom: 20px; /* Space for the tag */
        }


        /* Confetti styles */
        .confetti-container {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; overflow: hidden; z-index: 50;
        }
        .confetti {
            position: absolute; width: 8px; height: 16px;
            background: #f00; opacity: 0;
            animation: confetti-fall 4s ease-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
        
        /* Loading text animation */
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        #loading-text::after {
            content: '.';
            animation: dots 1.5s steps(3, end) infinite;
        }

        /* Modal styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .themed-title {
            background-image: linear-gradient(to right, var(--color-primary-from), var(--color-primary-to));
        }
        .btn-primary {
            background-image: linear-gradient(to right, var(--color-primary-from), var(--color-primary-to));
        }
        .btn-primary:hover {
            background-image: linear-gradient(to right, var(--color-primary-from), var(--color-primary-to));
        }
        .icon-primary {
            color: var(--color-primary);
        }
        
        /* Progress bar */
        .progress-bar-bg {
            background-color: #eef2ff;
        }
        .progress-bar-fill {
            background-color: var(--color-primary);
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* --- START OF CHATBOT STYLES --- */
        #chat-bubble { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: var(--color-primary);
            color: white; 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
            font-size: 26px; 
            transition: transform 0.2s ease; 
            z-index: 1000;
        }
        #chat-bubble:hover { 
            transform: scale(1.1); 
        }
        #chat-window { 
            position: fixed; 
            bottom: 90px; 
            right: 20px; 
            width: 340px; 
            max-height: 500px; 
            background: white; 
            border-radius: 16px; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 6px 18px rgba(0,0,0,0.3); 
            overflow: hidden; 
            animation: fadeIn 0.3s ease; 
            font-family: 'Inter', sans-serif;
            z-index: 1000;
        }
        #chat-window.hidden { 
            display: none; 
        }
        #chat-header { 
            background: var(--color-primary);
            color: white; 
            padding: 12px; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 15px; 
        }
        #chat-header button { 
            background:none; 
            border:none; 
            color:white; 
            font-size:16px; 
            cursor:pointer; 
        }
        #language-select { 
            width: 100%; 
            padding: 10px; 
            border: none; 
            border-bottom: 1px solid #eee; 
            font-size: 14px; 
            outline: none; 
        }
        #chat-messages { 
            flex: 1; 
            padding: 15px; 
            overflow-y: auto; 
            background: #f8fafc;
            scroll-behavior: smooth; 
        }
        .chat-message { 
            margin: 8px 0; 
            padding: 10px 14px; 
            border-radius: 18px; 
            max-width: 80%; 
            word-wrap: break-word; 
            font-size: 14px; 
            line-height: 1.4; 
            animation: fadeInUp 0.3s ease; 
        }
        .chat-message.user { 
            background: var(--color-primary);
            color: white; 
            margin-left: auto; 
            border-bottom-right-radius: 4px; 
        }
        .chat-message.bot { 
            background: #eef2ff;
            color: #1f2937;
            margin-right: auto; 
            border-bottom-left-radius: 4px; 
        }
        #chat-form { 
            display: flex; 
            border-top: 1px solid #ddd; 
            background: #fff; 
        }
        #chat-input { 
            flex: 1; 
            border: none; 
            padding: 12px; 
            font-size: 14px; 
            outline: none; 
            border-radius: 0 0 0 16px; 
        }
        #chat-form button { 
            background: var(--color-primary); 
            color: white; 
            border: none; 
            padding: 0 18px; 
            cursor: pointer; 
            font-size: 16px; 
            border-radius: 0 0 16px 0; 
            transition: background 0.2s ease; 
        }
        #chat-form button:hover { 
            background: var(--color-primary-hover);
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px);} 
            to { opacity: 1; transform: translateY(0);} 
        }
        @keyframes fadeInUp { 
            from { opacity: 0; transform: translateY(8px);} 
            to { opacity: 1; transform: translateY(0);} 
        }
        /* --- END OF CHATBOT STYLES --- */
    </style>
</head>
<body class="text-slate-800">

    <div id="confetti-container"></div>

    <!-- Main Container -->
    <div class="container mx-auto max-w-3xl p-4 sm:p-6 md:p-8">

        <!-- Header -->
        <header class="text-center mb-8 relative">
            <div class="absolute top-0 right-0">
                <div class="relative inline-flex items-center">
                    <i class="ph ph-translate text-slate-500 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none z-10"></i>
                    <select id="language-selector" class="appearance-none bg-white border border-slate-300 text-slate-700 text-sm rounded-lg focus:ring-2 focus:ring-indigo-400 focus:outline-none block w-full p-2 pl-9 pr-8 transition">
                        <option value="en">English</option>
                        <option value="hi">рд╣рд┐рдиреНрджреА</option>
                        <option value="bn">ржмрж╛ржВрж▓рж╛</option>
                        <option value="ta">родрооро┐ро┤рпН</option>
                        <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
                        <option value="or">рмУрмбрм╝рм┐рмЖ</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                        <i class="ph ph-caret-down"></i>
                    </div>
                </div>
            </div>
            <h1 class="themed-title text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text">AtlasIntern</h1>
            <p class="text-slate-500 mt-2">
                <span id="welcome-greeting"></span> 
                <span data-translate-key="tagline">Your Smart Internship Navigator.</span>
            </p>
            <div class="mt-4 flex justify-center items-center space-x-4">
                <label for="resume-file" class="cursor-pointer text-sm font-semibold text-purple-600 hover:text-purple-800 transition-transform duration-200 transform hover:-translate-y-px">
                    <i class="ph ph-file-arrow-up mr-1"></i>
                    <span data-translate-key="upload_resume">Upload Resume</span>
                </label>
                <input type="file" id="resume-file" accept=".pdf" class="hidden">

                <span class="text-slate-300">|</span>

                <button id="linkedin-btn" class="cursor-pointer text-sm font-semibold text-indigo-600 hover:text-indigo-800 transition-transform duration-200 transform hover:-translate-y-px">
                    <i class="ph-fill ph-linkedin-logo mr-1"></i>
                    <span data-translate-key="analyze_linkedin">Analyze with LinkedIn</span>
                </button>
            </div>
        </header>

        <!-- Main application container -->
        <main id="app-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-200/50 relative min-h-[500px]">
            
            <!-- Progress Bar -->
             <div id="progress-bar-container" class="w-full progress-bar-bg rounded-full h-2.5 mb-8">
                <div id="progress-bar" class="progress-bar-fill h-2.5 rounded-full" style="width: 25%"></div>
            </div>
            
            <!-- Wizard Form -->
            <form id="wizard-form">
                <div class="wizard-steps-container" style="min-height: 320px;">
                    <!-- Step 1: Education -->
                    <div id="step-1" class="wizard-step active-forward">
                        <h2 class="text-xl font-semibold mb-4 text-center" data-translate-key="step1_title">First, what's your education level?</h2>
                        <div id="education-container" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                            <!-- Education options will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <!-- Step 2: Skills -->
                    <div id="step-2" class="wizard-step">
                         <h2 class="text-xl font-semibold mb-4 text-center" data-translate-key="step2_title">What are your top skills?</h2>
                         <div id="skill-sort-controls" class="flex flex-wrap justify-center items-center gap-2 mb-6 bg-slate-100 p-1 rounded-full">
                            <span class="text-xs font-medium text-slate-600 mr-2" data-translate-key="sort_skills_by">Sort by:</span>
                            <button type="button" data-sort="alpha" class="sort-btn active font-semibold py-1 px-3 rounded-full text-xs">A-Z</button>
                            <button type="button" data-sort="trending" class="sort-btn font-semibold py-1 px-3 rounded-full text-xs" data-translate-key="sort_trending">Trending</button>
                            <button type="button" data-sort="highestPaid" class="sort-btn font-semibold py-1 px-3 rounded-full text-xs" data-translate-key="sort_highest_paid">Highest Paid</button>
                            <button type="button" data-sort="future" class="sort-btn font-semibold py-1 px-3 rounded-full text-xs" data-translate-key="sort_future">Future</button>
                         </div>
                         <div id="skills-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                            <!-- Skills will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <!-- Step 3: Interests -->
                    <div id="step-3" class="wizard-step">
                         <h2 class="text-xl font-semibold mb-4 text-center" data-translate-key="step3_title">What fields interest you?</h2>
                         <div id="interests-container" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                            <!-- Interests will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- Step 4: Location -->
                    <div id="step-4" class="wizard-step">
                        <h2 class="text-xl font-semibold mb-4 text-center" data-translate-key="step4_title">Finally, any location preferences?</h2>
                        <div class="max-w-md mx-auto space-y-4">
                            <div class="relative">
                                <select id="location" name="location" class="appearance-none bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-indigo-400 focus:outline-none block w-full p-3 pr-8 transition">
                                    <!-- Locations will be dynamically populated -->
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                                    <i class="ph ph-caret-down"></i>
                                </div>
                            </div>
                             <div class="flex items-center justify-center">
                                <input id="remote" name="remote" type="checkbox" class="w-4 h-4 text-indigo-600 bg-slate-100 border-slate-300 rounded focus:ring-indigo-500">
                                <label for="remote" class="ml-2 text-sm font-medium text-slate-900" data-translate-key="remote_option">I'm open to remote / work-from-home</label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

             <!-- Navigation Buttons -->
            <div id="navigation-section" class="absolute bottom-6 right-6 left-6 mt-12 pt-6 border-t border-slate-200">
                <div class="flex justify-between items-center">
                    <button id="prev-btn" class="interactive-btn bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors" data-translate-key="prev_btn">Previous</button>
                    <button id="next-btn" class="interactive-btn btn-primary text-white font-bold py-2 px-5 rounded-lg transition-colors flex items-center justify-center">
                        <span class="btn-text" data-translate-key="next_btn">Next</span><i class="ph ph-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Loading Section: Shown while processing -->
            <div id="loading-section" class="text-center py-16 hidden">
                 <div class="inline-block w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full spinner"></div>
                 <p id="loading-text" data-translate-key="loading_text" class="text-lg font-semibold mt-4 text-slate-600">Finding internships</p>
            </div>

            <!-- Results Section: Displays the recommendations -->
            <div id="results-section" class="hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6" data-translate-key="results_title">Your Top Recommendations</h2>
                <div id="sort-controls" class="flex justify-center items-center space-x-2 mb-8 bg-slate-100 p-1 rounded-full">
                    <span class="text-sm font-medium text-slate-600 mr-2" data-translate-key="sort_by">Sort by:</span>
                    <button data-sort="matchPercentage" class="sort-btn active font-semibold py-1.5 px-4 rounded-full text-sm">
                        <span data-translate-key="sort_match">Match %</span>
                    </button>
                    <button data-sort="stipend" class="sort-btn font-semibold py-1.5 px-4 rounded-full text-sm">
                        <span data-translate-key="sort_stipend">Stipend</span>
                    </button>
                    <button data-sort="location" class="sort-btn font-semibold py-1.5 px-4 rounded-full text-sm">
                        <span data-translate-key="sort_location">Location</span>
                    </button>
                </div>
                <div id="recommendations-container" class="space-y-6">
                    <!-- Recommendation cards will be inserted here -->
                </div>

                <!-- Skill Gap Analysis Section -->
                <div id="skill-gap-section" class="mt-10 text-center">
                    <button id="analyze-gap-btn" class="interactive-btn bg-indigo-100 text-indigo-700 font-bold py-3 px-6 rounded-lg hover:bg-indigo-200 transition-colors">
                        <i class="ph ph-arrows-split mr-2"></i>Analyze Your Skill Gaps
                    </button>
                    <div id="skill-gap-results" class="hidden mt-6 p-6 bg-slate-50 rounded-xl border border-slate-200">
                        <!-- Analysis will be injected here by JS -->
                    </div>
                </div>

                <div class="text-center mt-8">
                    <button onclick="startOver()" class="interactive-btn bg-slate-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-slate-700 transition-colors">
                        <i class="ph ph-arrow-counter-clockwise mr-2"></i><span data-translate-key="start_over_btn">Start Over</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- LinkedIn Modal -->
    <div id="linkedin-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-overlay opacity-0">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6 sm:p-8 modal-content transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" data-translate-key="linkedin_modal_title">Analyze LinkedIn Profile</h3>
                <button id="close-modal-btn" class="text-slate-400 hover:text-slate-600">
                    <i class="ph-fill ph-x-circle text-3xl"></i>
                </button>
            </div>
            <form id="linkedin-form">
                <div class="space-y-4">
                    <label for="linkedin-url" class="block text-sm font-medium text-slate-700" data-translate-key="linkedin_modal_label">Paste your LinkedIn profile URL</label>
                    <input type="url" id="linkedin-url" name="linkedin-url" class="block w-full border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-3" placeholder="https://www.linkedin.com/in/your-profile" required>
                </div>
                <div class="mt-8">
                    <button type="submit" class="interactive-btn btn-primary text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center text-lg">
                         <i class="ph-fill ph-magic-wand mr-2"></i>
                         <span data-translate-key="linkedin_modal_submit">Analyze Profile</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Chat Bubble -->
    <div id="chat-bubble">ЁЯТм</div>

    <!-- Chat Window -->
    <div id="chat-window" class="hidden">
        <div id="chat-header">
            Atlas Career Coach
            <button id="close-chat-btn">тЬЦ</button>
        </div>
        <div id="chat-messages"></div>
        <form id="chat-form">
            <input type="text" id="chat-input" placeholder="Ask for career advice...">
            <button type="submit">тЮд</button>
        </form>
    </div>

<script>
// --- START OF BACKEND SIMULATION & DATA ---

// This static DB is now a fallback or supplement to the live web search
const internshipsDB = [
    { id: 1, source: 'PM Portal', title: 'Public Policy Research Intern', company: 'NITI Aayog', location: 'Delhi', stipend: 10000, duration: 3, requiredQualification: 'Post Graduate', requiredStream: 'Arts', criticalSkills: ['Research'], preferredSkills: ['MS Office', 'Communication'], sector: 'Government', link: 'https://www.niti.gov.in/career/internship', applyLink: 'https://www.niti.gov.in/career/internship/application-form' },
    { id: 2, source: 'PM Portal', title: 'Software Development Engineer Intern', company: 'Tata Consultancy Services (TCS)', location: 'Bengaluru', stipend: 30000, duration: 6, requiredQualification: 'Graduate', requiredStream: 'Engineering', criticalSkills: ['Python', 'Databases'], preferredSkills: ['JavaScript'], sector: 'IT', link: 'https://www.tcs.com/careers/india/tcs-digital-hiring', applyLink: 'https://www.tcs.com/careers/india/tcs-digital-hiring-application' },
    { id: 3, source: 'PM Portal', title: 'Digital Marketing Intern', company: 'Zomato', location: 'Remote', stipend: 15000, duration: 4, requiredQualification: 'Graduate', requiredStream: 'Any', criticalSkills: ['Social Media Marketing'], preferredSkills: ['Canva', 'Content Writing'], sector: 'Marketing', link: 'https://www.zomato.com/careers', applyLink: 'https://www.zomato.com/careers/apply/digital-marketing-intern' },
];

const externalInternshipsDB = [
    { id: 101, source: 'External', title: 'React Developer Intern', company: 'InnovateTech (via LinkedIn)', location: 'Remote', stipend: 18000, duration: 3, requiredQualification: 'Graduate', requiredStream: 'Engineering', criticalSkills: ['JavaScript', 'React.js'], preferredSkills: ['HTML/CSS'], sector: 'IT', link: 'https://www.linkedin.com/jobs/', applyLink: 'https://www.linkedin.com/jobs/view/12345678' },
    { id: 102, source: 'External', title: 'Social Media Manager', company: 'GrowthHackers (via Internshala)', location: 'Mumbai', stipend: 10000, duration: 6, requiredQualification: 'Graduate', requiredStream: 'Any', criticalSkills: ['Social Media Marketing'], preferredSkills: ['Content Writing'], sector: 'Marketing', link: 'https://internshala.com/', applyLink: 'https://internshala.com/internship/details/social-media-marketing-internship-in-mumbai-at-growthhackers163067' },
];

// --- TRANSLATION DATA ---
const translations = {
    en: {
        tagline: "Your Smart Internship Navigator.",
        upload_resume: "Upload Resume",
        analyze_linkedin: "Analyze with LinkedIn",
        linkedin_modal_title: "Analyze LinkedIn Profile",
        linkedin_modal_label: "Paste your LinkedIn profile URL",
        linkedin_modal_submit: "Analyze Profile",
        analyzing_linkedin: "Analyzing LinkedIn Profile",
        step1_title: "First, what's your education level?",
        step2_title: "What are your top skills?",
        step3_title: "What fields interest you?",
        step4_title: "Finally, any location preferences?",
        remote_option: "I'm open to remote / work-from-home",
        prev_btn: "Previous",
        next_btn: "Next",
        find_btn: "Find Internships",
        loading_text: "Searching the web for internships",
        results_title: "Your Top Recommendations",
        start_over_btn: "Start Over",
        any_location: "Any Location",
        pm_portal: "PM Portal",
        external: "External",
        match: "MATCH",
        months: "Months",
        stipend_month: "/month",
        match_highlights: "Match Highlights:",
        learn_more: "Learn More",
        direct_apply: "Direct Apply",
        no_matches_title: "No Close Matches Found",
        no_matches_desc: "We couldn't find any internships that match your specific profile at the moment. Please check back later or try adjusting your selections.",
        best_fit_message: "We couldn't find a perfect match, but here are the closest opportunities available.",
        reason_remote: "Remote",
        reason_location: "Location",
        reason_nearby: "Nearby City",
        reason_qualification: "Qualification",
        reason_skills: "Skills",
        reason_interest: "Interest",
        sort_by: "Sort by:",
        sort_match: "Match %",
        sort_stipend: "Stipend",
        sort_location: "Location",
        sort_skills_by: "Sort skills by:",
        sort_trending: "Trending",
        sort_highest_paid: "Highest Paid",
        sort_future: "Future",
    },
    hi: {
        tagline: "рдЖрдкрдХрд╛ рд╕реНрдорд╛рд░реНрдЯ рдЗрдВрдЯрд░реНрдирд╢рд┐рдк рдиреЗрд╡рд┐рдЧреЗрдЯрд░ред",
        upload_resume: "рдмрд╛рдпреЛрдбрд╛рдЯрд╛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ",
        analyze_linkedin: "рд▓рд┐рдВрдХреНрдбрдЗрди рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ",
        linkedin_modal_title: "рд▓рд┐рдВрдХреНрдбрдЗрди рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ",
        linkedin_modal_label: "рдЕрдкрдирд╛ рд▓рд┐рдВрдХреНрдбрдЗрди рдкреНрд░реЛрдлрд╛рдЗрд▓ рдпреВрдЖрд░рдПрд▓ рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ",
        linkedin_modal_submit: "рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ",
        analyzing_linkedin: "рд▓рд┐рдВрдХреНрдбрдЗрди рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ",
        step1_title: "рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреА рд╢рд┐рдХреНрд╖рд╛ рдХрд╛ рд╕реНрддрд░ рдХреНрдпрд╛ рд╣реИ?",
        step2_title: "рдЖрдкрдХреЗ рд╢реАрд░реНрд╖ рдХреМрд╢рд▓ рдХреНрдпрд╛ рд╣реИрдВ?",
        step3_title: "рдЖрдкрдХреЛ рдХрд┐рди рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд╣реИ?",
        step4_title: "рдЕрдВрдд рдореЗрдВ, рдХреЛрдИ рд╕реНрдерд╛рди рд╡рд░реАрдпрддрд╛?",
        remote_option: "рдореИрдВ рд░рд┐рдореЛрдЯ / рдШрд░ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реВрдБ",
        prev_btn: "рдкрд┐рдЫрд▓рд╛",
        next_btn: "рдЕрдЧрд▓рд╛",
        find_btn: "рдЗрдВрдЯрд░реНрдирд╢рд┐рдк рдЦреЛрдЬреЗрдВ",
        loading_text: "рдЗрдВрдЯрд░реНрдирд╢рд┐рдк рдЦреЛрдЬрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ",
        results_title: "рдЖрдкрдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖ рд╕реБрдЭрд╛рд╡",
        start_over_btn: "рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ",
        any_location: "рдХреЛрдИ рднреА рд╕реНрдерд╛рди",
        pm_portal: "рдкреАрдПрдо рдкреЛрд░реНрдЯрд▓",
        external: "рдмрд╛рд╣рд░реА",
        match: "рдореИрдЪ",
        months: "рдорд╣реАрдиреЗ",
        stipend_month: "/рдорд╛рд╣",
        match_highlights: "рдореИрдЪ рдХреА рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:",
        learn_more: "рдФрд░ рдЬрд╛рдиреЗрдВ",
        direct_apply: "рд╕реАрдзреЗ рдЖрд╡реЗрджрди рдХрд░реЗрдВ",
        no_matches_title: "рдХреЛрдИ рдХрд░реАрдмреА рдореИрдЪ рдирд╣реАрдВ рдорд┐рд▓рд╛",
        no_matches_desc: "рд╣рдореЗрдВ рдЗрд╕ рд╕рдордп рдЖрдкрдХреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реА рдХреЛрдИ рдЗрдВрдЯрд░реНрдирд╢рд┐рдк рдирд╣реАрдВ рдорд┐рд▓реАред рдХреГрдкрдпрд╛ рдмрд╛рдж рдореЗрдВ рдлрд┐рд░ рд╕реЗ рджреЗрдЦреЗрдВ рдпрд╛ рдЕрдкрдиреЗ рдЪрдпрди рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред",
        best_fit_message: "рд╣рдореЗрдВ рдХреЛрдИ рд╕рдЯреАрдХ рдорд┐рд▓рд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдЙрдкрд▓рдмреНрдз рд╕рдмрд╕реЗ рдХрд░реАрдмреА рдЕрд╡рд╕рд░ рд╣реИрдВред",
        reason_remote: "рд░рд┐рдореЛрдЯ",
        reason_location: "рд╕реНрдерд╛рди",
        reason_nearby: "рдЖрд╕-рдкрд╛рд╕ рдХрд╛ рд╢рд╣рд░",
        reason_qualification: "рдпреЛрдЧреНрдпрддрд╛",
        reason_skills: "рдХреМрд╢рд▓",
        reason_interest: "рд░реБрдЪрд┐",
        sort_by: "рдЗрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ:",
        sort_match: "рдореИрдЪ %",
        sort_stipend: "рд╡рдЬреАрдлрд╛",
        sort_location: "рд╕реНрдерд╛рди",
        sort_skills_by: "рдХреМрд╢рд▓ рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ:",
        sort_trending: "рдЯреНрд░реЗрдВрдбрд┐рдВрдЧ",
        sort_highest_paid: "рдЙрдЪреНрдЪрддрдо рднреБрдЧрддрд╛рди",
        sort_future: "рднрд╡рд┐рд╖реНрдп",
    },
    bn: {
        tagline: "ржЖржкржирж╛рж░ рж╕рзНржорж╛рж░рзНржЯ ржЗржирзНржЯрж╛рж░рзНржирж╢рж┐ржк ржирзЗржнрж┐ржЧрзЗржЯрж░ред",
        upload_resume: "ржЬрзАржмржиржмрзГрждрзНрждрж╛ржирзНржд ржЖржкрж▓рзЛржб ржХрж░рзБржи",
        analyze_linkedin: "рж▓рж┐ржЩрзНржХржбржЗржи ржжрж┐ржпрж╝рзЗ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рзБржи",
        linkedin_modal_title: "рж▓рж┐ржЩрзНржХржбржЗржи ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рзБржи",
        linkedin_modal_label: "ржЖржкржирж╛рж░ рж▓рж┐ржЩрзНржХржбржЗржи ржкрзНрж░рзЛржлрж╛ржЗрж▓ URL ржкрзЗрж╕рзНржЯ ржХрж░рзБржи",
        linkedin_modal_submit: "ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рзБржи",
        analyzing_linkedin: "рж▓рж┐ржЩрзНржХржбржЗржи ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ",
        step1_title: "ржкрзНрж░ржержорзЗ, ржЖржкржирж╛рж░ рж╢рж┐ржХрзНрж╖рж╛ржЧржд ржпрзЛржЧрзНржпрждрж╛ ржХрзА?",
        step2_title: "ржЖржкржирж╛рж░ рж╢рзАрж░рзНрж╖ ржжржХрзНрж╖рждрж╛ ржХрж┐?",
        step3_title: "ржХрзЛржи ржХрзНрж╖рзЗрждрзНрж░рзЗ ржЖржкржирж╛рж░ ржЖржЧрзНрж░рж╣ ржЖржЫрзЗ?",
        step4_title: "ржЕржмрж╢рзЗрж╖рзЗ, ржХрзЛржи рж╕рзНржерж╛ржирзЗрж░ ржкржЫржирзНржж ржЖржЫрзЗ?",
        remote_option: "ржЖржорж┐ ржжрзВрж░ржмрж░рзНрждрзА / ржмрж╛ржбрж╝рж┐ ржерзЗржХрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржЖржЧрзНрж░рж╣рзА",
        prev_btn: "ржкрзВрж░рзНржмржмрж░рзНрждрзА",
        next_btn: "ржкрж░ржмрж░рзНрждрзА",
        find_btn: "ржЗржирзНржЯрж╛рж░рзНржирж╢рж┐ржк ржЦрзБржБржЬрзБржи",
        loading_text: "ржЗржирзНржЯрж╛рж░рзНржирж╢рж┐ржк ржЦрзЛржБржЬрж╛ рж╣ржЪрзНржЫрзЗ",
        results_title: "ржЖржкржирж╛рж░ ржЬржирзНржп рж╢рзАрж░рзНрж╖ рж╕рзБржкрж╛рж░рж┐рж╢",
        start_over_btn: "ржЖржмрж╛рж░ рж╢рзБрж░рзБ ржХрж░рзБржи",
        any_location: "ржпрзЗржХрзЛржирзЛ рж╕рзНржерж╛ржи",
        pm_portal: "ржкрж┐ржПржо ржкрзЛрж░рзНржЯрж╛рж▓",
        external: "ржмрж╛рж╣рзНржпрж┐ржХ",
        match: "ржорзНржпрж╛ржЪ",
        months: "ржорж╛рж╕",
        stipend_month: "/ржорж╛рж╕",
        match_highlights: "ржорзНржпрж╛ржЪрзЗрж░ рж╣рж╛ржЗрж▓рж╛ржЗржЯрж╕:",
        learn_more: "ржЖрж░ржУ ржЬрж╛ржирзБржи",
        direct_apply: "рж╕рж░рж╛рж╕рж░рж┐ ржЖржмрзЗржжржи ржХрж░рзБржи",
        no_matches_title: "ржХрж╛ржЫрж╛ржХрж╛ржЫрж┐ ржХрзЛржирзЛ ржорж┐рж▓ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐",
        no_matches_desc: "ржПржЗ ржорзБрж╣рзВрж░рзНрждрзЗ ржЖржкржирж╛рж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓рзЗрж░ рж╕рж╛ржерзЗ ржорзЗрж▓рзЗ ржПржоржи ржХрзЛржирзЛ ржЗржирзНржЯрж╛рж░рзНржирж╢рж┐ржк ржЖржорж░рж╛ ржЦрзБржБржЬрзЗ ржкрж╛ржЗржирж┐ред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржкрж░рзЗ ржЖржмрж╛рж░ ржжрзЗржЦрзБржи ржмрж╛ ржЖржкржирж╛рж░ ржирж┐рж░рзНржмрж╛ржЪржи рж╕рж╛ржоржЮрзНржЬрж╕рзНржп ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред",
        best_fit_message: "ржЖржорж░рж╛ ржПржХржЯрж┐ ржирж┐ржЦрзБржБржд ржорж┐рж▓ ржЦрзБржБржЬрзЗ ржкрж╛ржЗржирж┐, рждржмрзЗ ржПржЦрж╛ржирзЗ рж╕ржмржЪрзЗржпрж╝рзЗ ржХрж╛ржЫрзЗрж░ рж╕рзБржпрзЛржЧржЧрзБрж▓рж┐ ржЙржкрж▓ржмрзНржз рж░ржпрж╝рзЗржЫрзЗред",
        reason_remote: "ржжрзВрж░ржмрж░рзНрждрзА",
        reason_location: "ржЕржмрж╕рзНржерж╛ржи",
        reason_nearby: "ржХрж╛ржЫрж╛ржХрж╛ржЫрж┐ рж╢рж╣рж░",
        reason_qualification: "ржпрзЛржЧрзНржпрждрж╛",
        reason_skills: "ржжржХрзНрж╖рждрж╛",
        reason_interest: "ржЖржЧрзНрж░рж╣",
        sort_by: "рж╕рж╛ржЬрж╛ржи:",
        sort_match: "ржорзНржпрж╛ржЪ %",
        sort_stipend: "рж╕рзНржЯрж╛ржЗржкрзЗржирзНржб",
        sort_location: "ржЕржмрж╕рзНржерж╛ржи",
        sort_skills_by: "ржжржХрзНрж╖рждрж╛ рж╕рж╛ржЬрж╛ржи:",
        sort_trending: "ржЯрзНрж░рзЗржирзНржбрж┐ржВ",
        sort_highest_paid: "рж╕рж░рзНржмрж╛ржзрж┐ржХ ржмрзЗрждржи",
        sort_future: "ржнржмрж┐рж╖рзНржпрзО",
    },
    ta: {
        tagline: "роЙроЩрпНроХро│рпН ро╕рпНрооро╛ро░рпНроЯрпН роЗройрпНроЯро░рпНройрпНро╖ро┐рокрпН роирпЗро╡ро┐роХрпЗроЯрпНроЯро░рпН.",
        upload_resume: "ро░рпЖро╕рпНропрпВроорпН рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН",
        analyze_linkedin: "ро▓ро┐роЩрпНроХрпНроЯрпНроЗройрпН роорпВро▓роорпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН",
        linkedin_modal_title: "ро▓ро┐роЩрпНроХрпНроЯрпНроЗройрпН роЪрпБропро╡ро┐ро╡ро░родрпНродрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН",
        linkedin_modal_label: "роЙроЩрпНроХро│рпН ро▓ро┐роЩрпНроХрпНроЯрпНроЗройрпН роЪрпБропро╡ро┐ро╡ро░ URLроР роТроЯрпНроЯро╡рпБроорпН",
        linkedin_modal_submit: "роЪрпБропро╡ро┐ро╡ро░родрпНродрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН",
        analyzing_linkedin: "ро▓ро┐роЩрпНроХрпНроЯрпНроЗройрпН роЪрпБропро╡ро┐ро╡ро░роорпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ро▒родрпБ",
        step1_title: "роорпБродро▓ро┐ро▓рпН, роЙроЩрпНроХро│рпН роХро▓рпНро╡ро┐ роиро┐ро▓рпИ роОройрпНрой?",
        step2_title: "роЙроЩрпНроХро│рпН роЪро┐ро▒роирпНрод родро┐ро▒роорпИроХро│рпН роОройрпНрой?",
        step3_title: "роОроирпНродродрпН родрпБро▒рпИроХро│ро┐ро▓рпН роЙроЩрпНроХро│рпБроХрпНроХрпБ роЖро░рпНро╡роорпН?",
        step4_title: "роЗро▒рпБродро┐ропро╛роХ, роПродрпЗройрпБроорпН роЗроЯ ро╡ро┐ро░рпБрокрпНрокродрпНродрпЗро░рпНро╡рпБроХро│рпН?",
        remote_option: "роиро╛ройрпН ро░ро┐роорпЛроЯрпН / ро╡рпАроЯрпНроЯро┐ро▓ро┐ро░рпБроирпНродрпБ ро╡рпЗро▓рпИ роЪрпЖропрпНропродрпН родропро╛ро░ро╛роХ роЙро│рпНро│рпЗройрпН",
        prev_btn: "роорпБроирпНродрпИропродрпБ",
        next_btn: "роЕроЯрпБродрпНродродрпБ",
        find_btn: "роЗройрпНроЯро░рпНройрпНро╖ро┐рокрпН роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХро╡рпБроорпН",
        loading_text: "роЗройрпНроЯро░рпНройрпНро╖ро┐рокрпН родрпЗроЯрокрпНрокроЯрпБроХро┐ро▒родрпБ",
        results_title: "роЙроЩрпНроХро│рпН роЪро┐ро▒роирпНрод рокро░ро┐роирпНродрпБро░рпИроХро│рпН",
        start_over_btn: "роорпАрогрпНроЯрпБроорпН родрпЖро╛роЯроЩрпНроХро╡рпБроорпН",
        any_location: "роОроирпНрод роЗроЯроорпБроорпН",
        pm_portal: "рокро┐роОроорпН рокрпЛро░рпНроЯро▓рпН",
        external: "ро╡рпЖро│ро┐",
        match: "рокрпКро░рпБродрпНродроорпН",
        months: "рооро╛родроЩрпНроХро│рпН",
        stipend_month: "/рооро╛родроорпН",
        match_highlights: "рокрпКро░рпБродрпНродродрпНродро┐ройрпН роЪро┐ро▒рокрпНрокроорпНроЪроЩрпНроХро│рпН:",
        learn_more: "роорпЗро▓рпБроорпН роЕро▒ро┐роХ",
        direct_apply: "роирпЗро░роЯро┐ропро╛роХ ро╡ро┐рогрпНрогрокрпНрокро┐роХрпНроХро╡рпБроорпН",
        no_matches_title: "роирпЖро░рпБроЩрпНроХро┐роп рокрпКро░рпБродрпНродроЩрпНроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ",
        no_matches_desc: "роЙроЩрпНроХро│рпН роЪрпБропро╡ро┐ро╡ро░родрпНродрпБроЯройрпН рокрпКро░рпБроирпНродроХрпНроХрпВроЯро┐роп роОроирпНрод роЗройрпНроЯро░рпНройрпНро╖ро┐рокрпНрокрпИропрпБроорпН роОроЩрпНроХро│ро╛ро▓рпН роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. родропро╡рпБроЪрпЖропрпНродрпБ рокро┐ройрпНройро░рпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН роЕро▓рпНро▓родрпБ роЙроЩрпНроХро│рпН родрпЗро░рпНро╡рпБроХро│рпИ роЪро░ро┐роЪрпЖропрпНроп роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.",
        best_fit_message: "роОроЩрпНроХро│ро╛ро▓рпН роЪро░ро┐ропро╛рой рокрпКро░рпБродрпНродродрпНродрпИроХрпН роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ, роЖройро╛ро▓рпН роЗроЩрпНроХрпЗ роХро┐роЯрпИроХрпНроХроХрпНроХрпВроЯро┐роп роирпЖро░рпБроЩрпНроХро┐роп ро╡ро╛ропрпНрокрпНрокрпБроХро│рпН роЙро│рпНро│рой.",
        reason_remote: "родрпЖро╛ро▓рпИроиро┐ро▓рпИ",
        reason_location: "роЗроЯроорпН",
        reason_nearby: "роЕро░рпБроХро┐ро▓рпБро│рпНро│ роироХро░роорпН",
        reason_qualification: "родроХрпБродро┐",
        reason_skills: "родро┐ро▒ройрпНроХро│рпН",
        reason_interest: "роЖро░рпНро╡роорпН",
        sort_by: "ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродрпБ:",
        sort_match: "рокрпКро░рпБродрпНродроорпН %",
        sort_stipend: "роКроХрпНроХродрпНродрпКроХрпИ",
        sort_location: "роЗроЯроорпН",
        sort_skills_by: "родро┐ро▒ройрпНроХро│рпИ ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродрпБ:",
        sort_trending: "рокро┐ро░рокро▓роорпН",
        sort_highest_paid: "роЕродро┐роХ роЪроорпНрокро│роорпН",
        sort_future: "роОродро┐ро░рпНроХро╛ро▓роорпН",
    },
    te: {
        tagline: "р░ор▒А р░╕р▒Нр░ор░╛р░░р▒Нр░Яр▒Н р░Зр░Вр░Яр░░р▒Нр░ир▒НтАМр░╖р░┐р░кр▒Н р░ир░╛р░╡р░┐р░Чр▒Зр░Яр░░р▒Н.",
        upload_resume: "р░░р▒Жр░Ьр▒Нр░пр▒Вр░ор▒Н р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐",
        analyze_linkedin: "р░▓р░┐р░Вр░Хр▒Нр░бр▒НтАМр░Зр░ир▒НтАМр░др▒Л р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░┐р░Вр░Ър░Вр░бр░┐",
        linkedin_modal_title: "р░▓р░┐р░Вр░Хр▒Нр░бр▒НтАМр░Зр░ир▒Н р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒НтАМр░ир▒Б р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░┐р░Вр░Ър░Вр░бр░┐",
        linkedin_modal_label: "р░ор▒А р░▓р░┐р░Вр░Хр▒Нр░бр▒НтАМр░Зр░ир▒Н р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒Н URLр░ир▒Б р░Ер░др░┐р░Хр░┐р░Вр░Ър░Вр░бр░┐",
        linkedin_modal_submit: "р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒НтАМр░ир▒Б р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░┐р░Вр░Ър░Вр░бр░┐",
        analyzing_linkedin: "р░▓р░┐р░Вр░Хр▒Нр░бр▒НтАМр░Зр░ир▒Н р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒Н р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░┐р░Вр░Ър░мр░бр▒Бр░др▒Лр░Вр░жр░┐",
        step1_title: "р░ор▒Кр░жр░Я, р░ор▒А р░╡р░┐р░жр▒Нр░пр░╛ р░╕р▒Нр░ер░╛р░пр░┐ р░Пр░ор░┐р░Яр░┐?",
        step2_title: "р░ор▒А р░Ер░Чр▒Нр░░ р░ир▒Ир░кр▒Бр░гр▒Нр░пр░╛р░▓р▒Б р░Пр░ор░┐р░Яр░┐?",
        step3_title: "р░ор▒Ар░Хр▒Б р░П р░░р░Вр░Чр░╛р░▓р░кр▒И р░Жр░╕р░Хр▒Нр░др░┐ р░Йр░Вр░жр░┐?",
        step4_title: "р░Ър░┐р░╡р░░р░Чр░╛, р░Пр░╡р▒Ир░ир░╛ р░╕р▒Нр░ер░╛р░и р░кр▒Нр░░р░╛р░зр░╛р░ир▒Нр░пр░др░▓р▒Б р░Йр░ир▒Нр░ир░╛р░пр░╛?",
        remote_option: "р░ир▒Зр░ир▒Б р░░р░┐р░ор▒Лр░Яр▒Н / р░Зр░Вр░Яр░┐ р░ир▒Бр░Вр░бр░┐ р░кр░ир░┐ р░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░╕р░┐р░жр▒Нр░зр░Вр░Чр░╛ р░Йр░ир▒Нр░ир░╛р░ир▒Б",
        prev_btn: "р░ор▒Бр░ир▒Бр░кр░Яр░┐р░жр░┐",
        next_btn: "р░др░░р▒Бр░╡р░╛р░д",
        find_btn: "р░Зр░Вр░Яр░░р▒Нр░ир▒НтАМр░╖р░┐р░кр▒НтАМр░▓р░ир▒Б р░Хр░ир▒Бр░Чр▒Кр░ир░Вр░бр░┐",
        loading_text: "р░Зр░Вр░Яр░░р▒Нр░ир▒НтАМр░╖р░┐р░кр▒НтАМр░▓ р░Хр▒Лр░╕р░В р░╡р▒Жр░др▒Бр░Хр▒Бр░др▒Лр░Вр░жр░┐",
        results_title: "р░ор▒А р░Ер░Чр▒Нр░░ р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Бр░▓р▒Б",
        start_over_btn: "р░ор░│р▒Нр░▓р▒А р░кр▒Нр░░р░╛р░░р░Вр░нр░┐р░Вр░Ър▒Б",
        any_location: "р░Пр░жр▒Ир░ир░╛ р░кр▒Нр░░р░жр▒Зр░╢р░В",
        pm_portal: "р░кр▒Ар░Ор░ор▒Н р░кр▒Лр░░р▒Нр░Яр░▓р▒Н",
        external: "р░мр░╛р░╣р▒Нр░п",
        match: "р░╕р░░р░┐р░кр▒Лр░▓р░┐р░Х",
        months: "р░ир▒Жр░▓р░▓р▒Б",
        stipend_month: "/р░ир▒Жр░▓",
        match_highlights: "р░╕р░░р░┐р░кр▒Лр░▓р░┐р░Х р░ор▒Бр░Цр▒Нр░пр░╛р░Вр░╢р░╛р░▓р▒Б:",
        learn_more: "р░ор░░р░┐р░Вр░д р░др▒Жр░▓р▒Бр░╕р▒Бр░Хр▒Лр░Вр░бсГШ",
        direct_apply: "р░ир▒Зр░░р▒Бр░Чр░╛ р░жр░░р░Цр░╛р░╕р▒Нр░др▒Б р░Ър▒Зр░╕р▒Бр░Хр▒Лр░Вр░бр░┐",
        no_matches_title: "р░жр░Чр▒Нр░Чр░░р░┐ р░╕р░░р░┐р░кр▒Лр░▓р░┐р░Хр░▓р▒Б р░Хр░ир▒Бр░Чр▒Кр░ир░мр░бр░▓р▒Зр░жр▒Б",
        no_matches_desc: "р░кр▒Нр░░р░╕р▒Нр░др▒Бр░др░╛р░ир░┐р░Хр░┐ р░ор▒А р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒НтАМр░Хр▒Б р░╕р░░р░┐р░кр▒Лр░пр▒З р░Зр░Вр░Яр░░р▒Нр░ир▒НтАМр░╖р░┐р░кр▒НтАМр░▓р░ир▒Б р░ор▒Зр░ор▒Б р░Хр░ир▒Бр░Чр▒Кр░ир░▓р▒Зр░Хр░кр▒Лр░пр░╛р░ор▒Б. р░жр░пр░Ър▒Зр░╕р░┐ р░др░░р▒Нр░╡р░╛р░д р░ор░│р▒Нр░▓р▒А р░др░ир░┐р░Цр▒А р░Ър▒Зр░пр░Вр░бр░┐ р░▓р▒Зр░жр░╛ р░ор▒А р░Ор░Вр░кр░┐р░Хр░▓р░ир▒Б р░╕р░░р▒Нр░жр▒Бр░мр░╛р░Яр▒Б р░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░кр▒Нр░░р░пр░др▒Нр░ир░┐р░Вр░Ър░Вр░бр░┐.",
        best_fit_message: "р░ор▒Зр░ор▒Б р░╕р░░р▒Ир░и р░╕рж░р░┐р░кр▒Лр░▓р░┐р░Хр░ир▒Б р░Хр░ир▒Бр░Чр▒Кр░ир░▓р▒Зр░Хр░кр▒Лр░пр░╛р░ор▒Б, р░Хр░╛р░ир▒А р░Зр░Хр▒Нр░Хр░б р░Ер░Вр░жр▒Бр░мр░╛р░Яр▒Бр░▓р▒Л р░Йр░ир▒Нр░и р░Ер░др▒Нр░пр░Вр░д р░╕р░ир▒Нр░ир░┐р░╣р░┐р░д р░Ер░╡р░Хр░╛р░╢р░╛р░▓р▒Б р░Йр░ир▒Нр░ир░╛р░пр░┐.",
        reason_remote: "р░░р░┐р░ор▒Лр░Яр▒Н",
        reason_location: "р░кр▒Нр░░р░жр▒Зр░╢р░В",
        reason_nearby: "р░╕р░ор▒Ар░к р░ир░Чр░░р░В",
        reason_qualification: "р░Ер░░р▒Нр░╣р░д",
        reason_skills: "р░ир▒Ир░кр▒Бр░гр▒Нр░пр░╛р░▓р▒Б",
        reason_interest: "р░Жр░╕р░Хр▒Нр░др░┐",
        sort_by: "р░Хр▒Нр░░р░ор░мр░жр▒Нр░зр▒Ар░Хр░░р░┐р░Вр░Ър▒Б:",
        sort_match: "р░╕р░░р░┐р░кр▒Лр░▓р░┐р░Х %",
        sort_stipend: "р░╕р▒Нр░Яр▒Ир░лр░Вр░бр▒Н",
        sort_location: "р░кр▒Нр░░р░жр▒Зр░╢р░В",
        sort_skills_by: "р░ир▒Ир░кр▒Бр░гр▒Нр░пр░╛р░▓р░ир▒Б р░Хр▒Нр░░р░ор░мр░жр▒Нр░зр▒Ар░Хрд░р░┐р░Вр░Ър░Вр░бр░┐:",
        sort_trending: "р░Яр▒Нр░░р▒Жр░Вр░бр░┐р░Вр░Чр▒Н",
        sort_highest_paid: "р░Ер░др▒Нр░пр░зр░┐р░Х р░Ьр▒Ар░др░В",
        sort_future: "р░нр░╡р░┐р░╖р▒Нр░пр░др▒Нр░др▒Б",
    },
    or: {
        tagline: "рмЖрмкрмгрмЩрнНрмХ рм╕рнНрморм╛рм░рнНрмЯ рмЗрмгрнНрмЯрм░рнНрмирм╕рм┐рмкрнН рмирм╛рмнрм┐рмЧрнЗрмЯрм░рнНред",
        upload_resume: "рм░рнЗрмЬрнНрнЯрнБрморнН рмЕрмкрм▓рнЛрмбрнН рмХрм░рмирнНрмдрнБ",
        analyze_linkedin: "рм▓рм┐рмЩрнНрмХрмбрмЗрмирнН рм╕рм╣рм┐рмд рммрм┐рм╢рнНрм│рнЗрм╖рмг рмХрм░рмирнНрмдрнБ",
        linkedin_modal_title: "рм▓рм┐рмЩрнНрмХрмбрмЗрмирнН рмкрнНрм░рнЛрмлрм╛рмЗрм▓рнН рммрм┐рм╢рнНрм│рнЗрм╖рмг рмХрм░рмирнНрмдрнБ",
        linkedin_modal_label: "рмЖрмкрмгрмЩрнНрмХ рм▓рм┐рмЩрнНрмХрмбрмЗрмирнН рмкрнНрм░рнЛрмлрм╛рмЗрм▓рнН URL рмкрнЗрм╖рнНрмЯ рмХрм░рмирнНрмдрнБ",
        linkedin_modal_submit: "рмкрнНрм░рнЛрмлрм╛рмЗрм▓рнН рммрм┐рм╢рнНрм│рнЗрм╖рмг рмХрм░рмирнНрмдрнБ",
        analyzing_linkedin: "рм▓рм┐рмЩрнНрмХрмбрмЗрмирнН рмкрнНрм░рнЛрмлрм╛рмЗрм▓рнН рммрм┐рм╢рнНрм│рнЗрм╖рмг рмХрм░рм╛рмпрм╛рмЙрмЫрм┐",
        step1_title: "рмкрнНрм░рмерморнЗ, рмЖрмкрмгрмЩрнНрмХ рм╢рм┐рмХрнНрм╖рм╛рмЧрмд рм╕рнНрмдрм░ рмХ'рмг?",
        step2_title: "рмЖрмкрмгрмЩрнНрмХ рм╢рнАрм░рнНрм╖ рмжрмХрнНрм╖рмдрм╛ рмХ'рмг?",
        step3_title: "рмХрнЗрмЙрмБ рмХрнНрм╖рнЗрмдрнНрм░рм░рнЗ рмЖрмкрмгрмЩрнНрмХрм░ рмЖрмЧрнНрм░рм╣ рмЕрмЫрм┐?",
        step4_title: "рм╢рнЗрм╖рм░рнЗ, рмХрнМрмгрм╕рм┐ рм╕рнНрмерм╛рми рмкрм╕рмирнНрмж рмЕрмЫрм┐ рмХрм┐?",
        remote_option: "рморнБрмБ рм░рм┐рморнЛрмЯрнН / рмШрм░рнБ рмХрм╛рмо рмХрм░рм┐рммрм╛рмХрнБ рмкрнНрм░рм╕рнНрмдрнБрмд",
        prev_btn: "рмкрнВрм░рнНрммрммрм░рнНрмдрнНрмдрнА",
        next_btn: "рмкрм░рммрм░рнНрмдрнНрмдрнА",
        find_btn: "рмЗрмгрнНрмЯрм░рнНрмирм╕рм┐рмкрнН рмЦрнЛрмЬрмирнНрмдрнБ",
        loading_text: "рмЗрмгрнНрмЯрм░рнНрмирм╕рм┐рмкрнН рмЦрнЛрмЬрм╛рмпрм╛рмЙрмЫрм┐",
        results_title: "рмЖрмкрмгрмЩрнНрмХ рмкрм╛рмЗрмБ рм╢рнАрм░рнНрм╖ рм╕рнБрмкрм╛рм░рм┐рм╢",
        start_over_btn: "рмкрнБрмгрм┐ рмЖрм░рморнНрмн рмХрм░рмирнНрмдрнБ",
        any_location: "рмпрнЗрмХрнМрмгрм╕рм┐ рм╕рнНрмерм╛рми",
        pm_portal: "рмкрм┐рмПрморнН рмкрнЛрм░рнНрмЯрм╛рм▓рнН",
        external: "рммрм╛рм╣рнНрнЯ",
        match: "рморнЗрм│",
        months: "рморм╛рм╕",
        stipend_month: "/рморм╛рм╕",
        match_highlights: "рморнЗрм│рм░ рморнБрмЦрнНрнЯрм╛рмВрм╢:",
        learn_more: "рмЕрмзрм┐рмХ рмЬрм╛рмгрмирнНрмдрнБ",
        direct_apply: "рм╕рм┐рмзрм╛рм╕рм│рмЦ рмЖрммрнЗрмжрми рмХрм░рмирнНрмдрнБ",
        no_matches_title: "рмХрнМрмгрм╕рм┐ рмирм┐рмХрмЯрмдрм░ рморнЗрм│ рморм┐рм│рм┐рм▓рм╛ рмирм╛рм╣рм┐рмБ",
        no_matches_desc: "рмЖрморнЗ рмПрм╣рм┐ рморнБрм╣рнВрм░рнНрмдрнНрмдрм░рнЗ рмЖрмкрмгрмЩрнНрмХ рмкрнНрм░рнЛрмлрм╛рмЗрм▓рнН рм╕рм╣рм┐рмд рморнЗрм│ рмЦрм╛рмЙрмерм┐рммрм╛ рмХрнМрмгрм╕рм┐ рмЗрмгрнНрмЯрм░рнНрмирм╕рм┐рмкрнН рмкрм╛рмЗрм▓рнБ рмирм╛рм╣рм┐рмБред рмжрнЯрм╛рмХрм░рм┐ рмкрм░рнЗ рмкрнБрмгрм┐ рмпрм╛рмЮрнНрмЪ рмХрм░рмирнНрмдрнБ рмХрм┐рморнНрммрм╛ рмЖрмкрмгрмЩрнНрмХ рмЪрнЯрмирмХрнБ рм╕рмЬрм╛рмбрм╝рм┐рммрм╛рмХрнБ рмЪрнЗрм╖рнНрмЯрм╛ рмХрм░рмирнНрмдрнБред",
        best_fit_message: "рмЖрморнЗ рмПрмХ рм╕рмарм┐рмХрнН рдореЗрд│ рмкрм╛рмЗрм▓рнБ рмирм╛рм╣рм┐рмБ, рмХрм┐рмирнНрмдрнБ рмПрмарм╛рм░рнЗ рмЙрмкрм▓рммрнНрмз рмирм┐рмХрмЯрмдрмо рм╕рнБрмпрнЛрмЧрмЧрнБрмбрм╝рм┐рмХ рмЕрмЫрм┐ред",
        reason_remote: "рм░рм┐рморнЛрмЯрнН",
        reason_location: "рм╕рнНрмерм╛рми",
        reason_nearby: "рмирм┐рмХрмЯрммрм░рнНрмдрнНрмдрнА рм╕рм╣рм░",
        reason_qualification: "рмпрнЛрмЧрнНрнЯрмдрм╛",
        reason_skills: "рмжрмХрнНрм╖рмдрм╛",
        reason_interest: "рмЖрмЧрнНрм░рм╣",
        sort_by: "рмХрнНрм░рмо:",
        sort_match: "рморнЗрм│ %",
        sort_stipend: "рм╖рнНрмЯрм╛рмЗрмкрнЗрмгрнНрмб",
        sort_location: "рм╕рнНрмерм╛рми",
        sort_skills_by: "рмХрнМрм╢рм│ рмХрнНрм░рмо:",
        sort_trending: "рмЯрнНрм░рнЗрмгрнНрмбрм┐рмВ",
        sort_highest_paid: "рм╕рм░рнНрммрм╛рмзрм┐рмХ рммрнЗрмдрми",
        sort_future: "рмнрммрм┐рм╖рнНрнЯрмд",
    }
};
const allSkills = [
    { name: 'MS Office' }, { name: 'MS Excel' }, { name: 'Communication' }, { name: 'Content Writing' },
    { name: 'Social Media Marketing', tag: 'Trending Now' }, { name: 'HTML/CSS' }, { name: 'JavaScript' },
    { name: 'Python', tag: 'Highest Paid' }, { name: 'SQL' }, { name: 'UI/UX Design', tag: 'Trending Now' },
    { name: 'Figma' }, { name: 'Financial Modeling', tag: 'Highest Paid' }, { name: 'Databases' },
    { name: 'React.js', tag: 'Trending Now' }, { name: 'Node.js' }, { name: 'Canva' }, { name: 'Video Editing' },
    { name: 'Public Speaking' }, { name: 'Research' }, { name: 'Java' }, { name: 'C++' },
    { name: 'AWS', tag: 'Highest Paid' }, { name: 'Docker' }, { name: 'Git' },
    { name: 'Machine Learning', tag: 'Bright Future' }, { name: 'Data Analysis', tag: 'Highest Paid' },
    { name: 'Tableau' }, { name: 'AutoCAD' }, { name: 'SEO' }, { name: 'Adobe Photoshop' },
    { name: 'Adobe Premiere Pro' }, { name: 'Project Management' }, { name: 'Public Relations' },
    { name: 'Market Research' }, { name: 'Leadership' },
    { name: 'Digital Marketing', tag: 'Trending Now' },
    { name: 'Tally' },
    { name: 'Google Analytics', tag: 'Trending Now' },
    { name: 'Salesforce', tag: 'Highest Paid' },
    { name: 'MongoDB' },
    { name: 'Cybersecurity', tag: 'Bright Future' },
    { name: 'Blockchain', tag: 'Bright Future' },
    { name: 'Go', tag: 'Trending Now' },
    { name: 'Kotlin' },
    { name: 'Swift' },
    { name: 'TensorFlow', tag: 'Bright Future' },
    { name: 'Kubernetes', tag: 'Highest Paid' }
];

const allInterests = [{ name: 'IT', icon: 'ph-code', keywords: ['software', 'developer', 'it', 'tech', 'engineering'] }, { name: 'Marketing', icon: 'ph-megaphone-simple', keywords: ['marketing', 'social media', 'seo'] }, { name: 'Finance', icon: 'ph-chart-line-up', keywords: ['finance', 'accounts', 'investment', 'commerce'] }, { name: 'HR', icon: 'ph-users-three', keywords: ['hr', 'human resources', 'recruitment'] }, { name: 'Business', icon: 'ph-briefcase', keywords: ['business', 'sales', 'management'] }, { name: 'Design', icon: 'ph-paint-brush', keywords: ['design', 'ui/ux', 'figma'] }, { name: 'Media', icon: 'ph-newspaper', keywords: ['media', 'content', 'writing'] }, { name: 'Operations', icon: 'ph-stack', keywords: ['operations', 'supply chain', 'logistics'] }, { name: 'Government', icon: 'ph-bank', keywords: ['government', 'policy', 'arts'] }];
const allLocations = ["Any", "Maheshtala", "Kolkata", "Delhi", "Mumbai", "Bengaluru", "Chennai", "Hyderabad", "Pune", "Ahmedabad", "Jaipur"];
const educationOptions = [
    { qualification: 'Graduate', stream: 'Engineering', icon: 'ph-desktop-tower' },
    { qualification: 'Graduate', stream: 'Commerce', icon: 'ph-briefcase' },
    { qualification: 'Graduate', stream: 'Science', icon: 'ph-atom' },
    { qualification: 'Post Graduate', stream: 'Any', icon: 'ph-graduation-cap' },
    { qualification: 'Diploma', stream: 'Any', icon: 'ph-file-text' },
    { qualification: '12th Pass', stream: 'Any', icon: 'ph-student' },
];
const locationProximity = { Maheshtala: ["Kolkata"], Kolkata: ["Maheshtala"] };
const qualificationHierarchy = { '12th Pass': 1, 'Diploma': 2, 'Graduate': 3, 'Post Graduate': 4 };
const weights = { location: 50, qualification: 40, stream: 20, criticalSkills: 45, preferredSkills: 15, interests: 25 };


// --- CORE AI & ANALYSIS LOGIC ---
async function fetchInternshipsFromWeb(profile) {
    const apiKey = ""; // This will be handled by the environment
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

    const systemPrompt = `You are an expert career counselor specializing in finding internships for students in India. Your task is to find relevant, recent internship postings from the web based on the user's profile. Return a list of up to 5 internships in a structured JSON format. For each internship, set the "source" field to "Web". Provide the title, company, location, a brief description, and a direct application link if available. Only return internships posted within the last 30 days. Prioritize official company career pages and reputable job boards like LinkedIn, Internshala, and Naukri.com.`;
    
    const userQuery = `Find internships in India for a '${profile.qualification}' candidate, preferably in the '${profile.stream}' stream. Their preferred location is '${profile.location}'${profile.remote ? ', but they are also open to remote roles' : ''}. Key skills include: ${profile.skills.join(', ')}. They are interested in the following sectors: ${profile.interests.join(', ')}.`;

    const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        tools: [{ "google_search": {} }],
        systemInstruction: {
            parts: [{ text: systemPrompt }]
        },
        generationConfig: {
            responseMimeType: "application/json",
            responseSchema: {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "id": { "type": "NUMBER" },
                        "source": { "type": "STRING" },
                        "title": { "type": "STRING" },
                        "company": { "type": "STRING" },
                        "location": { "type": "STRING" },
                        "stipend": { "type": "NUMBER" },
                        "duration": { "type": "NUMBER" },
                        "requiredQualification": { "type": "STRING" },
                        "requiredStream": { "type": "STRING" },
                        "criticalSkills": { "type": "ARRAY", "items": { "type": "STRING" } },
                        "preferredSkills": { "type": "ARRAY", "items": { "type": "STRING" } },
                        "sector": { "type": "STRING" },
                        "link": { "type": "STRING" },
                        "applyLink": { "type": "STRING" }
                    },
                }
            }
        }
    };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
             const jsonText = result.candidates[0].content.parts[0].text;
             try {
                return JSON.parse(jsonText);
             } catch (e) {
                console.error("Failed to parse JSON from Gemini:", e, jsonText);
                return []; // Return empty on parsing error
             }
        }
        return [];
    } catch (error) {
        console.error("Error fetching internships from web:", error);
        return []; // Return empty array on network error
    }
}


function analyzeResume(text) {
    const textLower = text.toLowerCase();
    const profile = {};
    profile.skills = allSkills.map(s => s.name).filter(skill => textLower.includes(skill.toLowerCase()));
    
    const eduKeywords = [
        { key: 'Post Graduate', terms: ['post graduate', 'master', 'm.tech', 'm.sc', 'm.a', 'mba'] },
        { key: 'Graduate', terms: ['graduate', 'bachelor', 'b.tech', 'b.sc', 'b.a', 'bba'] },
        { key: 'Diploma', terms: ['diploma'] }
    ];
    profile.qualification = eduKeywords.find(edu => edu.terms.some(term => textLower.includes(term)))?.key || '12th Pass';
    
    const streamKeywords = [
        { key: 'Engineering', terms: ['engineering', 'b.tech'] },
        { key: 'Commerce', terms: ['commerce', 'b.com', 'bba'] },
        { key: 'Science', terms: ['science', 'b.sc'] },
        { key: 'Arts', terms: ['arts', 'b.a'] }
    ];
    profile.stream = streamKeywords.find(s => s.terms.some(term => textLower.includes(term)))?.key || 'Any';
    
    profile.interests = allInterests.filter(i => i.keywords.some(kw => textLower.includes(kw))).map(i => i.name);
    if(profile.interests.length === 0) profile.interests.push('Business');
    profile.location = allLocations.find(loc => loc !== "Any" && textLower.includes(loc.toLowerCase())) || 'Any';
    profile.remote = textLower.includes('remote');
    return profile;
}

function simulateLinkedInScraping(url) {
    console.log("Simulating dynamic scraping for:", url);
    const getSeed = (str) => {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = ((hash << 5) - hash) + str.charCodeAt(i);
            hash |= 0;
        }
        return Math.abs(hash);
    };
    const seed = getSeed(url);
    const randomFrom = (arr, index) => arr[index % arr.length];
    const education = randomFrom(educationOptions, seed);
    const numSkills = 3 + (seed % 5);
    const selectedSkills = new Set();
    for (let i = 0; i < numSkills; i++) selectedSkills.add(randomFrom(allSkills, seed + i * 17).name);
    const numInterests = 1 + (seed % 3);
    const selectedInterests = new Set();
    for (let i = 0; i < numInterests; i++) selectedInterests.add(randomFrom(allInterests, seed + i * 23).name);
    const location = randomFrom(allLocations.filter(l => l !== 'Any'), seed);
    return {
        qualification: education.qualification,
        stream: education.stream,
        skills: Array.from(selectedSkills),
        interests: Array.from(selectedInterests),
        location: location,
        remote: (seed % 2 === 0),
    };
}


async function getRecommendations(candidateProfile) {
    const webInternships = await fetchInternshipsFromWeb(candidateProfile);
    const allInternships = [...webInternships, ...internshipsDB, ...externalInternshipsDB];
    
    const uniqueInternships = allInternships.filter((internship, index, self) =>
        internship && internship.title && internship.company && index === self.findIndex((t) => (
            t.title === internship.title && t.company === internship.company
        ))
    );

    const scoredInternships = uniqueInternships
        .map(internship => calculateMatchScore(internship, candidateProfile))
        .filter(internship => internship.score > -1);
        
    return scoredInternships.sort((a, b) => b.score - a.score).slice(0, 5);
}

function calculateMatchScore(internship, candidateProfile) {
    let score = 0;
    let maxScore = 0;
    let reasons = [];

    const safeCriticalSkills = internship.criticalSkills || [];
    const safePreferredSkills = internship.preferredSkills || [];

    maxScore += weights.location + weights.qualification + weights.interests;
    if (internship.requiredStream && internship.requiredStream !== 'Any') maxScore += weights.stream;
    maxScore += weights.criticalSkills + weights.preferredSkills;

    if (qualificationHierarchy[candidateProfile.qualification] < qualificationHierarchy[internship.requiredQualification]) {
        return { ...internship, score: -1, reasons: [], matchPercentage: 0 };
    }
    
    let locationMatch = false;
    if (internship.location === 'Remote' && candidateProfile.remote) {
        score += weights.location;
        reasons.push({ key: 'reason_remote', icon: 'ph-house' });
        locationMatch = true;
    } else if (candidateProfile.location === 'Any' || candidateProfile.location === internship.location) {
        score += weights.location;
        reasons.push({ key: 'reason_location', icon: 'ph-map-pin' });
        locationMatch = true;
    } else if (locationProximity[candidateProfile.location]?.includes(internship.location)) {
        score += weights.location * 0.8;
        reasons.push({ key: 'reason_nearby', icon: 'ph-map-trifold' });
        locationMatch = true;
    }
    if (!locationMatch && !candidateProfile.remote && internship.location !== 'Remote') return { ...internship, score: -1, reasons: [], matchPercentage: 0 };
    if (!locationMatch && internship.location !== 'Remote') {
         // Allow remote jobs to pass through if user is open to anything
        if (candidateProfile.location !== 'Any') {
            return { ...internship, score: -1, reasons: [], matchPercentage: 0 };
        }
    }


    if (internship.requiredQualification === candidateProfile.qualification) {
        score += weights.qualification;
        reasons.push({ key: 'reason_qualification', icon: 'ph-graduation-cap' });
    }
    if (internship.requiredStream === 'Any' || internship.requiredStream === candidateProfile.stream) {
        score += weights.stream;
    }

    const matchedCritical = safeCriticalSkills.filter(s => candidateProfile.skills.includes(s));
    const matchedPreferred = safePreferredSkills.filter(s => candidateProfile.skills.includes(s));
    
    if (safeCriticalSkills.length > 0) {
        score += (matchedCritical.length / safeCriticalSkills.length) * weights.criticalSkills;
    } else {
        score += weights.criticalSkills; // No critical skills required, so full points
    }

    if (safePreferredSkills.length > 0) {
        score += (matchedPreferred.length / safePreferredSkills.length) * weights.preferredSkills;
    } else {
        score += weights.preferredSkills; // No preferred skills, so full points
    }

    if (matchedCritical.length > 0 || matchedPreferred.length > 0) {
         reasons.push({key: 'reason_skills', icon: 'ph-star'});
    }


    if (internship.sector && candidateProfile.interests.some(interest => interest === internship.sector)) {
        score += weights.interests;
        reasons.push({ key: 'reason_interest', icon: 'ph-sparkle' });
    }

    const matchPercentage = maxScore > 0 ? Math.min(Math.round((score / maxScore) * 100), 99) : 0;
    return { ...internship, score, reasons, matchPercentage };
}


// --- START OF FRONTEND LOGIC ---
let currentStep = 1;
const totalSteps = 4;
let currentLang = 'en';
let currentRecommendations = [];
let currentUserProfile = {};


function translateUI(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-translate-key]').forEach(el => {
        const key = el.dataset.translateKey;
        if (translations[lang] && translations[lang][key]) {
            el.innerText = translations[lang][key];
        }
    });
    populateDynamicContent(lang);
    updateWizardUI();
}

function populateDynamicContent(lang = 'en') {
    const eduContainer = document.getElementById('education-container');
    eduContainer.innerHTML = '';
    educationOptions.forEach((edu, index) => {
        const id = `edu-${index}`;
        eduContainer.innerHTML += `
            <div>
                <input type="radio" id="${id}" name="education" value='${JSON.stringify({q: edu.qualification, s: edu.stream})}' class="hidden peer">
                <label for="${id}" class="selectable-card flex flex-col items-center p-4 border border-slate-300 rounded-lg cursor-pointer h-full">
                    <div class="checkmark"><i class="ph-fill ph-check text-base"></i></div>
                    <i class="ph-fill ${edu.icon} text-3xl icon-primary mb-2"></i>
                    <span class="text-sm font-semibold text-center">${edu.qualification === '12th Pass' ? '12th Pass' : `${edu.stream} ${edu.qualification}`}</span>
                </label>
            </div>`;
    });

    sortAndPopulateSkills(); 
    
    const interestsContainer = document.getElementById('interests-container');
    interestsContainer.innerHTML = '';
    allInterests.forEach(interest => {
        const id = `interest-${interest.name.replace(/\s/g, '-')}`;
        interestsContainer.innerHTML += `<div><input type="checkbox" id="${id}" name="interests" value="${interest.name}" class="hidden peer"><label for="${id}" class="selectable-card flex flex-col items-center p-4 border border-slate-300 rounded-lg cursor-pointer h-full"><div class="checkmark"><i class="ph-fill ph-check text-base"></i></div><i class="ph-fill ${interest.icon} text-3xl icon-primary mb-2 mx-auto"></i><span class="text-sm font-semibold text-slate-800">${interest.name}</span></label></div>`;
    });
    
    const locationSelect = document.getElementById('location');
    locationSelect.innerHTML = '';
    allLocations.forEach(loc => {
         locationSelect.innerHTML += `<option value="${loc}">${loc === 'Any' ? translations[lang].any_location : loc}</option>`;
    });
}

function sortAndPopulateSkills(sortBy = 'alpha') {
    const skillsContainer = document.getElementById('skills-container');
    const checkedSkills = Array.from(skillsContainer.querySelectorAll('input:checked')).map(el => el.value);

    let sortedSkills = [...allSkills];
    const tagMap = {
        highestPaid: 'Highest Paid',
        trending: 'Trending Now',
        future: 'Bright Future'
    };

    if (sortBy !== 'alpha') {
        const targetTag = tagMap[sortBy];
        sortedSkills.sort((a, b) => {
            const aHasTag = a.tag === targetTag;
            const bHasTag = b.tag === targetTag;
            if (aHasTag && !bHasTag) return -1;
            if (!aHasTag && bHasTag) return 1;
            return a.name.localeCompare(b.name);
        });
    } else {
        sortedSkills.sort((a,b) => a.name.localeCompare(b.name));
    }
    
    skillsContainer.innerHTML = '';
    sortedSkills.forEach(skill => {
        const id = `skill-${skill.name.replace(/[\s\.]/g, '-')}`;
        const isChecked = checkedSkills.includes(skill.name);
        let tagHtml = '';
        if (skill.tag) {
            let colorClasses = '';
            if (skill.tag === 'Trending Now') colorClasses = 'bg-blue-100 text-blue-800';
            if (skill.tag === 'Highest Paid') colorClasses = 'bg-green-100 text-green-800';
            if (skill.tag === 'Bright Future') colorClasses = 'bg-purple-100 text-purple-800';
            tagHtml = `<span class="skill-tag ${colorClasses}">${skill.tag}</span>`;
        }
        
        skillsContainer.innerHTML += `
            <div>
                <input type="checkbox" id="${id}" name="skills" value="${skill.name}" class="hidden peer" ${isChecked ? 'checked' : ''}>
                <label for="${id}" class="selectable-card flex items-center justify-center text-center text-sm font-medium text-slate-700 p-3 border border-slate-300 rounded-lg cursor-pointer h-full">
                    <div class="checkmark"><i class="ph-fill ph-check text-base"></i></div>
                    <span class="skill-card-name">${skill.name}</span>
                    ${tagHtml}
                </label>
            </div>`;
    });
}

function showUI(section) {
    ['wizard-form', 'navigation-section', 'loading-section', 'results-section'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });
    const sectionEl = document.getElementById(section);
    if(sectionEl) sectionEl.style.display = 'block';

    const navSection = document.getElementById('navigation-section');
    if(section === 'wizard-form' && navSection) {
        navSection.style.display = 'flex';
    }
}


function navigate(direction) {
    if (currentStep === 1 && direction < 0) return;
    if (currentStep === totalSteps && direction > 0) {
        submitManualForm();
        return;
    }
    
    if(direction > 0 && currentStep === 1 && !document.querySelector('input[name="education"]:checked')) {
        alert('Please select your education level.');
        return;
    }
    
    const currentStepEl = document.getElementById(`step-${currentStep}`);
    currentStepEl.classList.remove('active-forward', 'active-backward');
    currentStep += direction;
    const newStepEl = document.getElementById(`step-${currentStep}`);
    newStepEl.classList.add(direction > 0 ? 'active-forward' : 'active-backward');
    updateWizardUI();
}

function updateWizardUI() {
    document.getElementById('prev-btn').style.visibility = currentStep > 1 ? 'visible' : 'hidden';
    const nextBtnText = document.getElementById('next-btn').querySelector('.btn-text');
    const nextBtnIcon = document.getElementById('next-btn').querySelector('i');
    
    if (currentStep === totalSteps) {
        nextBtnText.innerText = translations[currentLang].find_btn;
        nextBtnIcon.className = 'ph-fill ph-rocket-launch ml-2';
    } else {
        nextBtnText.innerText = translations[currentLang].next_btn;
        nextBtnIcon.className = 'ph ph-arrow-right ml-2';
    }
    
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = `${(currentStep / totalSteps) * 100}%`;
    document.getElementById('progress-bar-container').style.display = currentStep > 0 && currentStep <= totalSteps ? 'block' : 'none';
}

async function showLoadingAndGetRecs(candidateProfile, loadingMessage) {
    currentUserProfile = candidateProfile;
    const message = loadingMessage || translations[currentLang].loading_text;
    showUI('loading-section');
    document.getElementById('loading-text').innerText = message;
    
    currentRecommendations = await getRecommendations(candidateProfile);
    sortRecommendations('matchPercentage');
    displayRecommendations(currentRecommendations);
}

function submitManualForm() {
    const form = document.getElementById('wizard-form');
    const formData = new FormData(form);
    const educationValue = formData.get('education');
    if (!educationValue) {
        alert('Please select your education level.');
        return;
    }
    const education = JSON.parse(educationValue);
    const candidateProfile = {
        qualification: education.q,
        stream: education.s,
        skills: formData.getAll('skills'),
        interests: formData.getAll('interests'),
        location: formData.get('location'),
        remote: formData.get('remote') === 'on',
    };
    showLoadingAndGetRecs(candidateProfile);
}

function renderRecommendations(recommendations) {
    const container = document.getElementById('recommendations-container');
    container.innerHTML = '';
    
    if (recommendations.length > 0) {
        recommendations.forEach((internship, index) => {
            const reasonsHtml = internship.reasons.map(reason => {
                const translatedText = translations[currentLang][reason.key] || reason.key.replace('reason_', '');
                return `<div class="flex items-center bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full"><i class="ph-fill ${reason.icon} mr-1.5"></i> ${translatedText}</div>`;
            }).join('');
            
            let sourceTag = '';
            if (internship.source === 'PM Portal') {
                sourceTag = `<span class="inline-flex items-center bg-green-500 text-white text-sm font-bold px-3 py-1 rounded-md shadow-sm"><i class="ph-fill ph-check-circle mr-1.5"></i>${translations[currentLang].pm_portal}</span>`;
            } else if (internship.source === 'Web') {
                sourceTag = `<span class="inline-flex items-center bg-sky-500 text-white text-sm font-bold px-3 py-1 rounded-md shadow-sm"><i class="ph-fill ph-globe-hemisphere-west mr-1.5"></i>Found via Web</span>`;
            } else {
                 sourceTag = `<span class="inline-flex items-center bg-indigo-500 text-white text-sm font-bold px-3 py-1 rounded-md shadow-sm"><i class="ph-fill ph-buildings mr-1.5"></i>${internship.source || 'External'}</span>`;
            }

            const cardBorderClass = internship.source === 'PM Portal' ? 'border-green-500' : internship.source === 'Web' ? 'border-sky-500' : 'border-indigo-500';

            container.innerHTML += `
                <div class="internship-card bg-white rounded-xl shadow-lg relative border-t-4 ${cardBorderClass}" style="animation-delay: ${index * 100}ms;">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            ${sourceTag}
                            <div class="text-right">
                               <div class="text-2xl font-bold text-indigo-600">${internship.matchPercentage}%</div>
                               <div class="text-xs text-slate-500 font-semibold">${translations[currentLang].match}</div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-slate-800">${internship.title}</h3>
                            <p class="text-slate-600 font-medium">${internship.company}</p>
                        </div>
                        <div class="flex flex-wrap items-center text-sm text-slate-500 mt-3 gap-x-4 gap-y-1">
                            <span class="flex items-center"><i class="ph-fill ph-map-pin mr-1"></i> ${internship.location || 'N/A'}</span>
                            <span class="flex items-center"><i class="ph-fill ph-clock mr-1"></i> ${internship.duration || 'N/A'} ${translations[currentLang].months}</span>
                             <span class="flex items-center"><i class="ph-fill ph-currency-inr mr-1"></i> ${internship.stipend || 'N/A'}${translations[currentLang].stipend_month}</span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <h4 class="font-semibold text-slate-800 mb-3 text-sm">${translations[currentLang].match_highlights}</h4>
                            <div class="flex flex-wrap gap-2">${reasonsHtml}</div>
                        </div>
                        <div class="mt-6 flex justify-end items-center gap-3">
                            <a href="${internship.link}" target="_blank" rel="noopener noreferrer" class="interactive-btn text-sm text-slate-600 font-semibold hover:text-indigo-600 transition-colors">Learn More</a>
                            <a href="${internship.applyLink}" target="_blank" rel="noopener noreferrer" class="interactive-btn bg-green-500 text-white font-bold py-2 px-5 rounded-lg hover:bg-green-600 transition-colors flex items-center"><i class="ph-fill ph-rocket-launch mr-2"></i>${translations[currentLang].direct_apply}</a>
                        </div>
                    </div>
                </div>`;
        });
    }
}


function displayRecommendations(recommendations) {
    const resultsSection = document.getElementById('results-section');
    const container = document.getElementById('recommendations-container');
    
    const existingMessage = resultsSection.querySelector('.best-fit-message');
    if (existingMessage) existingMessage.remove();

    showUI('results-section');
    
    document.getElementById('sort-controls').classList.toggle('hidden', recommendations.length === 0);
    document.getElementById('skill-gap-section').classList.toggle('hidden', recommendations.length === 0);


    if (recommendations.length === 0) {
        container.innerHTML = `<div class="text-center p-8 bg-slate-50 rounded-lg"><i class="ph-fill ph-magnifying-glass text-5xl text-slate-400 mb-4"></i><h3 class="text-xl font-semibold">${translations[currentLang].no_matches_title}</h3><p class="text-slate-600 mt-2">${translations[currentLang].no_matches_desc}</p></div>`;
    } else {
        if (recommendations[0].matchPercentage < 40) {
            const message = `<div class="best-fit-message text-center p-4 mb-6 bg-yellow-50 border border-yellow-200 rounded-lg"><p class="text-sm text-yellow-800">${translations[currentLang].best_fit_message}</p></div>`;
            resultsSection.querySelector('h2').insertAdjacentHTML('afterend', message);
        }
        
        renderRecommendations(recommendations);
        if (!document.body.classList.contains('results-shown-before')) {
            launchConfetti();
            document.body.classList.add('results-shown-before');
        }
    }
}


function sortRecommendations(sortBy) {
    if (currentRecommendations.length === 0) return;

    if (sortBy === 'matchPercentage') {
        currentRecommendations.sort((a, b) => b.matchPercentage - a.matchPercentage);
    } else if (sortBy === 'stipend') {
        currentRecommendations.sort((a, b) => (b.stipend || 0) - (a.stipend || 0));
    } else if (sortBy === 'location') {
        currentRecommendations.sort((a, b) => (a.location || '').localeCompare(b.location || ''));
    }
    
    renderRecommendations(currentRecommendations);
}


function startOver() {
    showUI('wizard-form');
    document.getElementById('wizard-form').reset();
    document.getElementById('resume-file').value = '';
    document.body.classList.remove('results-shown-before');
    
    document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active-forward', 'active-backward'));
    currentStep = 1;
    document.getElementById('step-1').classList.add('active-forward');
    updateWizardUI();
    
    const resultsSection = document.getElementById('results-section');
    const existingMessage = resultsSection.querySelector('.best-fit-message');
    if (existingMessage) existingMessage.remove();

    const sortButtons = document.querySelectorAll('.sort-btn');
    sortButtons.forEach(btn => btn.classList.remove('active'));
    document.querySelector('.sort-btn[data-sort="matchPercentage"]').classList.add('active');

    const skillGapResults = document.getElementById('skill-gap-results');
    const analyzeGapBtn = document.getElementById('analyze-gap-btn');
    skillGapResults.classList.add('hidden');
    skillGapResults.innerHTML = '';
    analyzeGapBtn.classList.remove('hidden');
}

function updateWelcomeMessage() {
    const hour = new Date().getHours();
    let greeting = "Welcome!";
    if (hour < 12) greeting = "Good Morning!";
    else if (hour < 18) greeting = "Good Afternoon!";
    else greeting = "Good Evening!";
    document.getElementById('welcome-greeting').innerText = greeting;
}

function launchConfetti() {
    const container = document.getElementById('confetti-container');
    const colors = ['#4f46e5', '#10b981', '#ef4444', '#f97316', '#8b5cf6'];
    for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.animationDelay = Math.random() * 2 + 's';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        container.appendChild(confetti);
    }
    setTimeout(() => { container.innerHTML = ''; }, 6000);
}

async function handlePdfUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    try {
        const reader = new FileReader();
        reader.readAsArrayBuffer(file);
        reader.onload = async (e) => {
            const pdfData = new Uint8Array(e.target.result);
            const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ');
            }
            const profile = analyzeResume(fullText);
            await showLoadingAndGetRecs(profile, "Analyzing your resume...");
        };
    } catch (error) {
        console.error('Error processing PDF:', error);
        alert('Could not read the PDF file. Please try again.');
        startOver();
    }
}

async function handleLinkedInUrl(url) {
    closeModal();
    const profile = simulateLinkedInScraping(url);
    await showLoadingAndGetRecs(profile, translations[currentLang].analyzing_linkedin);
}

function openModal() {
    const modal = document.getElementById('linkedin-modal');
    modal.classList.remove('hidden');
    setTimeout(() => {
        modal.classList.remove('opacity-0');
        modal.querySelector('.modal-content').classList.remove('scale-95');
    }, 10);
}

function closeModal() {
    const modal = document.getElementById('linkedin-modal');
    modal.classList.add('opacity-0');
    modal.querySelector('.modal-content').classList.add('scale-95');
    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300);
}

function analyzeSkillGaps() {
    const resultsContainer = document.getElementById('skill-gap-results');
    const analyzeBtn = document.getElementById('analyze-gap-btn');
    
    const userSkills = new Set(currentUserProfile.skills);

    const marketSkills = new Set();
    currentRecommendations.forEach(internship => {
        (internship.criticalSkills || []).forEach(skill => marketSkills.add(skill));
        (internship.preferredSkills || []).forEach(skill => marketSkills.add(skill));
    });

    const skillGap = [...marketSkills].filter(skill => !userSkills.has(skill));

    const createSkillList = (skills, title, color, icon) => {
        let listHtml = skills.map(skill => `<span class="inline-block bg-white text-slate-700 text-sm font-medium mr-2 mb-2 px-3 py-1 rounded-full border border-slate-300">${skill}</span>`).join('');
        if (skills.length === 0) {
            listHtml = `<p class="text-slate-500 italic">No specific skills listed.</p>`;
        }
        return `
            <div>
                <h4 class="text-lg font-semibold mb-3 text-left flex items-center ${color}">
                    <i class="ph-fill ${icon} mr-2"></i>${title}
                </h4>
                <div class="text-left">${listHtml}</div>
            </div>
        `;
    };

    const yourSkillsHtml = createSkillList(Array.from(userSkills), 'Your Current Skills', 'text-blue-600', 'ph-user');
    const marketSkillsHtml = createSkillList(Array.from(marketSkills), 'In-Demand Skills for You', 'text-green-600', 'ph-trend-up');
    const gapSkillsHtml = createSkillList(skillGap, 'Your Skill Gaps to Bridge', 'text-red-600', 'ph-arrows-split');

    resultsContainer.innerHTML = `
        <h3 class="text-2xl font-bold text-center mb-6">Skill Gap Analysis</h3>
        <div class="space-y-6">
            ${yourSkillsHtml}
            ${marketSkillsHtml}
            ${gapSkillsHtml}
        </div>
        <div class="mt-6 pt-4 border-t border-slate-200">
            <p class="text-sm text-slate-500">Focus on learning the skills in the "gap" list to become an even stronger candidate for these roles!</p>
        </div>
        <div class="mt-6 text-center">
            <button id="get-learning-plan-btn" class="interactive-btn btn-primary text-white font-bold py-2 px-5 rounded-lg">
                тЬи Get AI Learning Plan
            </button>
            <div id="learning-plan-container" class="mt-4 text-left p-4 bg-white rounded-lg border border-slate-200 hidden"></div>
        </div>
    `;

    document.getElementById('get-learning-plan-btn').addEventListener('click', () => getAILearningPlan(Array.from(userSkills), skillGap));

    analyzeBtn.classList.add('hidden');
    resultsContainer.classList.remove('hidden');
}

async function getAILearningPlan(userSkills, skillGaps) {
    const btn = document.getElementById('get-learning-plan-btn');
    const container = document.getElementById('learning-plan-container');
    
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full"></span> Generating...';
    container.classList.remove('hidden');
    container.innerHTML = '<p class="text-slate-500 text-center">тЬи Our AI is crafting a personalized learning plan for you...</p>';

    const apiKey = "";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

    const systemPrompt = "You are a helpful career coach. Your goal is to provide a simple, actionable learning plan for a student looking to acquire new skills for internships. Be encouraging and provide links to free, high-quality resources.";
    
    const userQuery = `I am a student in India. My current skills are: ${userSkills.join(', ')}. To get a better internship, I need to learn these skills: ${skillGaps.join(', ')}. 
    
    Please provide a simple learning plan. For each skill I need to learn, suggest one or two free online resources like a specific YouTube playlist, a well-regarded tutorial series, or official documentation. Keep the descriptions brief. Format the output using simple markdown bullet points.`;

    const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: { parts: [{ text: systemPrompt }] },
    };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        let planText = "Sorry, I couldn't generate a plan right now. Please try again later.";
        if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
            planText = result.candidates[0].content.parts[0].text;
            // A simple way to format the markdown-like response to basic HTML
            planText = planText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\* (.*?)(?=\n\*|\n\n|$)/g, '<li>$1</li>')
                .replace(/(\r\n|\n|\r)/g, '<br>');
             planText = `<ul class="list-disc pl-5 space-y-2">${planText.replace(/<br>/g, '')}</ul>`;
        }
        container.innerHTML = `<h5 class="font-bold mb-2 text-lg">Your AI-Powered Learning Plan:</h5>${planText}`;
    } catch (error) {
        console.error("Error fetching learning plan:", error);
        container.innerHTML = '<p class="text-red-500">An error occurred while generating your plan. Please check the console for details.</p>';
    } finally {
        btn.style.display = 'none'; // Hide button after use
    }
}


document.addEventListener('DOMContentLoaded', () => {
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
    updateWelcomeMessage();
    populateDynamicContent('en');

    document.getElementById('next-btn').addEventListener('click', () => navigate(1));
    document.getElementById('prev-btn').addEventListener('click', () => navigate(-1));
    document.getElementById('resume-file').addEventListener('change', handlePdfUpload);
    document.getElementById('language-selector').addEventListener('change', (e) => translateUI(e.target.value));
    document.getElementById('analyze-gap-btn').addEventListener('click', analyzeSkillGaps);

    document.getElementById('linkedin-btn').addEventListener('click', openModal);
    document.getElementById('close-modal-btn').addEventListener('click', closeModal);
    document.getElementById('linkedin-form').addEventListener('submit', (e) => {
        e.preventDefault();
        handleLinkedInUrl(e.target['linkedin-url'].value);
    });
    
    const sortButtons = document.querySelectorAll('#sort-controls .sort-btn');
    sortButtons.forEach(button => {
        button.addEventListener('click', () => {
            sortButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            sortRecommendations(button.dataset.sort);
        });
    });
    
    const skillSortButtons = document.querySelectorAll('#skill-sort-controls .sort-btn');
    skillSortButtons.forEach(button => {
        button.addEventListener('click', () => {
            skillSortButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            sortAndPopulateSkills(button.dataset.sort);
        });
    });

    updateWizardUI();

    // --- CHATBOT LOGIC ---
    const chatBubble = document.getElementById('chat-bubble');
    const chatWindow = document.getElementById('chat-window');
    const closeChatBtn = document.getElementById('close-chat-btn');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');

    function appendChatMessage(content, sender = 'bot', isHTML = false) {
        const el = document.createElement('div');
        el.className = `chat-message ${sender}`;
        if (isHTML) {
            el.innerHTML = content;
        } else {
            el.innerText = content;
        }
        chatMessages.appendChild(el);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function getGeminiResponse(userText) {
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const systemPrompt = `You are 'Atlas', a friendly and helpful AI internship assistant for students in India. Your goal is to provide career advice. You can answer questions about the job market, suggest skills to learn, give tips for resume writing and interview preparation. Do NOT attempt to search for jobs; the main application already does that. Instead, focus on giving advice. Keep your responses concise, helpful, and encouraging. Format responses with simple markdown (bolding, lists).`;

        const payload = {
            contents: [{ parts: [{ text: userText }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            let botReply = "I'm having a little trouble thinking right now. Please try again in a moment.";
            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                botReply = result.candidates[0].content.parts[0].text;
            }
            // This is a simplified markdown to HTML converter for the chat
            botReply = botReply
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\* (.*?)(?=\n\* |\n\n|$)/g, '<li>$1</li>')
                .replace(/(\r\n|\n|\r)/g, '<br>');
            
            appendChatMessage(botReply, 'bot', true); // isHTML = true

        } catch (error) {
            console.error("Error with chatbot Gemini call:", error);
            appendChatMessage("Sorry, I encountered an error. Please try again.", 'bot');
        }
    }


    chatBubble.addEventListener('click', () => {
        chatWindow.classList.toggle('hidden');
        if (!chatWindow.classList.contains('hidden')) chatInput.focus();
    });

    closeChatBtn.addEventListener('click', () => {
        chatWindow.classList.add('hidden');
    });

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = chatInput.value.trim();
        if (!text) return;
        appendChatMessage(text, 'user');
        chatInput.value = '';

        const typing = document.createElement('div');
        typing.className = 'chat-message bot';
        typing.innerHTML = '<div class="spinner w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full"></div>';
        chatMessages.appendChild(typing);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        await getGeminiResponse(text);
        typing.remove();
    });

    appendChatMessage("Hello! I'm Atlas, your AI career coach. How can I help you prepare for your internship?", 'bot');
});

</script>

</body>
</html>

